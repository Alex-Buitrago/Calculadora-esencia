<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esencias Pro - Mobile & PC</title>
    <style>
        :root { --primary: #9d4edd; --accent: #c77dff; --bg: #0b0118; --card: #1a0033; }
        
        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background: var(--bg); color: #eee; 
            display: flex; justify-content: center; 
            padding: 15px; margin: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .container { 
            width: 100%; max-width: 500px; 
            background: var(--card); padding: 20px; 
            border-radius: 20px; border: 1px solid #5a189a; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
        }

        h2 { text-align: center; color: var(--accent); margin-bottom: 20px; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; }

        /* Grid de ConfiguraciÃ³n (Saldo/Meta) */
        .grid-config { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; 
        }

        .config-box { background: rgba(157, 78, 221, 0.1); padding: 10px; border-radius: 12px; border: 1px solid #3c096c; }
        label { font-size: 0.75rem; color: var(--accent); display: block; margin-bottom: 4px; font-weight: bold; }

        /* Grid de Items Adaptable */
        .grid-items { 
            display: grid; 
            grid-template-columns: 1fr 1fr; /* Por defecto 2 columnas para PC */
            gap: 10px; 
        }

        /* MEDIA QUERY PARA MÃ“VIL */
        @media (max-width: 480px) {
            .grid-items { grid-template-columns: 1fr; } /* En mÃ³vil 1 sola columna */
            .grid-config { grid-template-columns: 1fr; } /* Saldo y Meta uno sobre otro */
            input { font-size: 16px !important; } /* Evita que iOS haga zoom al escribir */
        }

        .item-card { 
            background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; 
            display: flex; justify-content: space-between; align-items: center; 
            border-left: 4px solid var(--primary);
            transition: transform 0.2s;
        }

        .item-card:active { transform: scale(0.98); background: rgba(255,255,255,0.08); }

        input { 
            width: 70px; background: #240046; border: 1px solid #7b2cbf; 
            color: white; padding: 8px; border-radius: 8px; text-align: right; 
            font-weight: bold; outline: none;
        }

        input:focus { border-color: var(--accent); box-shadow: 0 0 10px var(--primary); }
        .full-input { width: calc(100% - 20px); }

        /* Botones */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        button { 
            padding: 12px; border-radius: 10px; border: none; cursor: pointer; 
            font-weight: bold; font-size: 0.9rem; transition: 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-save { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(157, 78, 221, 0.3); }
        .btn-clear { background: #3c096c; color: #c77dff; }

        /* Resultados */
        .results { 
            margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.4); 
            border-radius: 15px; border: 1px solid var(--primary); 
        }
        .res-row { display: flex; justify-content: space-between; font-size: 1rem; margin-bottom: 5px; }
        .status { 
            text-align: center; font-weight: bold; margin-top: 10px; padding: 12px; 
            border-radius: 10px; font-size: 1rem;
        }
        .meta-ok { background: rgba(76, 175, 80, 0.2); color: #81c784; border: 1px solid #4caf50; }
        .meta-fail { background: rgba(244, 67, 54, 0.2); color: #e57373; border: 1px solid #f44336; }

        .recom-section { margin-top: 15px; background: #240046; padding: 15px; border-radius: 12px; border: 1px dashed var(--accent); }
        .recom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.85rem; }
        .optimo { color: #81c784; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>Calculadora de Esencias</h2>
    
    <div class="grid-config">
        <div class="config-box">
            <label>ðŸ’° SALDO ACTUAL</label>
            <input type="number" id="saldo-inicial" class="full-input" value="0" oninput="calcular()">
        </div>
        <div class="config-box">
            <label>ðŸŽ¯ META FINAL</label>
            <input type="number" id="meta-valor" class="full-input" value="0" oninput="calcular()">
        </div>
    </div>

    <div id="inputs-area" class="grid-items"></div>

    <div class="btn-group">
        <button class="btn-save" onclick="guardarProgreso()">ðŸ’¾ GUARDAR</button>
        <button class="btn-clear" onclick="limpiarTodo()">ðŸ§¹ LIMPIAR</button>
    </div>

    <div class="results">
        <div class="res-row"><span>Venta:</span><span id="total-venta">0</span></div>
        <div class="res-row" style="color: var(--accent); font-weight: bold;">
            <span>Total:</span><span id="nuevo-balance">0</span>
        </div>
        <div id="mensaje-meta" class="status meta-ok">Ingresa datos</div>
    </div>

    <div id="recomendacion-area" class="recom-section">
        <strong style="color:var(--accent); display:block; margin-bottom:10px; border-bottom:1px solid #3c096c; padding-bottom:5px;">ðŸ’¡ Sugerencias</strong>
        <div id="recom-list" class="recom-grid"></div>
    </div>
</div>

<script>
    const precios = {
        "MinÃºscula": 2.5, "PequeÃ±a": 5, "Mediana": 15,
        "Grande": 35, "Mayor": 50, "Superior": 75, "Ã‰pica": 100
    };

    const inputsArea = document.getElementById('inputs-area');
    const fmt = (n) => Math.ceil(n).toLocaleString('de-DE');

    Object.entries(precios).forEach(([nombre, precio]) => {
        const div = document.createElement('div');
        div.className = 'item-card';
        div.innerHTML = `
            <div><span style="display:block; font-size:0.9rem">${nombre}</span><b style="color:var(--accent); font-size:0.85rem">$${precio}</b></div>
            <input type="number" class="cant" id="input-${nombre}" min="0" placeholder="0" oninput="calcular()" data-precio="${precio}">
        `;
        inputsArea.appendChild(div);
    });

    function calcular() {
        const saldo = parseFloat(document.getElementById('saldo-inicial').value) || 0;
        const meta = parseFloat(document.getElementById('meta-valor').value) || 0;
        let venta = 0;
        
        document.querySelectorAll('.cant').forEach(i => {
            venta += (parseFloat(i.value) || 0) * parseFloat(i.dataset.precio);
        });

        const total = saldo + venta;
        const faltante = meta - total;
        
        document.getElementById('total-venta').innerText = fmt(venta);
        document.getElementById('nuevo-balance').innerText = fmt(total);

        const msg = document.getElementById('mensaje-meta');
        const recomArea = document.getElementById('recomendacion-area');
        const recomList = document.getElementById('recom-list');
        recomList.innerHTML = '';

        if (total >= meta) {
            msg.className = 'status meta-ok';
            msg.innerText = meta === 0 ? 'Esperando datos...' : 'Â¡META ALCANZADA! +' + fmt(total - meta);
            recomArea.style.display = 'none';
        } else {
            msg.className = 'status meta-fail';
            msg.innerText = 'Faltan: ' + fmt(faltante);
            recomArea.style.display = 'block';

            Object.entries(precios).reverse().forEach(([nombre, precio]) => {
                const unidades = Math.ceil(faltante / precio);
                const isOptimo = nombre === "Ã‰pica" ? 'class="optimo"' : '';
                recomList.innerHTML += `<div ${isOptimo}>${nombre}: <b>${fmt(unidades)}</b></div>`;
            });
        }
    }

    function guardarProgreso() {
        const datos = {
            saldo: document.getElementById('saldo-inicial').value,
            meta: document.getElementById('meta-valor').value,
            cantidades: {}
        };
        document.querySelectorAll('.cant').forEach(i => { datos.cantidades[i.id] = i.value; });
        localStorage.setItem('esencias_data_v2', JSON.stringify(datos));
        alert("Â¡Datos guardados!");
    }

    function cargarProgreso() {
        const guardado = localStorage.getItem('esencias_data_v2');
        if (guardado) {
            const datos = JSON.parse(guardado);
            document.getElementById('saldo-inicial').value = datos.saldo;
            document.getElementById('meta-valor').value = datos.meta;
            for (const id in datos.cantidades) {
                const input = document.getElementById(id);
                if (input) input.value = datos.cantidades[id];
            }
            calcular();
        }
    }

    function limpiarTodo() {
        if(confirm("Â¿Borrar todo?")) {
            localStorage.removeItem('esencias_data_v2');
            location.reload();
        }
    }

    cargarProgreso();
</script>

</body>
</html>
